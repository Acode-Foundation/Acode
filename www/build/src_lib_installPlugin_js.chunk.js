"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkcom_foxdebug_acode"] =
	self["webpackChunkcom_foxdebug_acode"] || []).push([
	["src_lib_installPlugin_js"],
	{
		/***/ "./src/lib/installPlugin.js":
			/*!**********************************!*\
  !*** ./src/lib/installPlugin.js ***!
  \**********************************/
			/***/ function (
				__unused_webpack_module,
				__webpack_exports__,
				__webpack_require__,
			) {
				eval(
					'{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": function() { return /* binding */ installPlugin; }\n/* harmony export */ });\n/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/toConsumableArray */ "./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js");\n/* harmony import */ var _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/slicedToArray */ "./node_modules/@babel/runtime/helpers/esm/slicedToArray.js");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ "./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @babel/runtime/regenerator */ "./node_modules/@babel/runtime/regenerator/index.js");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var fileSystem__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! fileSystem */ "./src/fileSystem/index.js");\n/* harmony import */ var _deadlyjack_ajax__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @deadlyjack/ajax */ "./node_modules/@deadlyjack/ajax/dist/ajax.js");\n/* harmony import */ var _deadlyjack_ajax__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_deadlyjack_ajax__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var dialogs_alert__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! dialogs/alert */ "./src/dialogs/alert.js");\n/* harmony import */ var dialogs_confirm__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! dialogs/confirm */ "./src/dialogs/confirm.js");\n/* harmony import */ var dialogs_loader__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! dialogs/loader */ "./src/dialogs/loader.js");\n/* harmony import */ var handlers_purchase__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! handlers/purchase */ "./src/handlers/purchase.js");\n/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! jszip */ "./node_modules/jszip/dist/jszip.min.js");\n/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(jszip__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var utils_helpers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! utils/helpers */ "./src/utils/helpers.js");\n/* harmony import */ var utils_Url__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! utils/Url */ "./src/utils/Url.js");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./constants */ "./src/lib/constants.js");\n/* harmony import */ var _installState__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./installState */ "./src/lib/installState.js");\n/* harmony import */ var _loadPlugin__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./loadPlugin */ "./src/lib/loadPlugin.js");\n\n\n\n\nfunction _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n/** @type {import("dialogs/loader").Loader} */\nvar loaderDialog;\n/** @type {Array<() => Promise<void>>} */\nvar depsLoaders;\n\n/**\n * Installs a plugin.\n * @param {string} id\n * @param {string} name\n * @param {string} purchaseToken\n * @param {boolean} isDependency\n */\nfunction installPlugin(_x, _x2, _x3, _x4) {\n  return _installPlugin.apply(this, arguments);\n}\n\n/**\n * Create directory recursively\n * @param {string} parent\n * @param {Array<string> | string} dir\n */\nfunction _installPlugin() {\n  _installPlugin = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee3(id, name, purchaseToken, isDependency) {\n    var pluginDir, pluginUrl, state, plugin, zip, pluginJson, manifests, titleText, shouldInstall, _iterator, _step, manifest, hasError, promises, _iterator2, _step2, _loader, _t2, _t3, _t4, _t5, _t6, _t7, _t8, _t9;\n    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          if (!isDependency) {\n            loaderDialog = dialogs_loader__WEBPACK_IMPORTED_MODULE_8__["default"].create(name || "Plugin", strings.installing, {\n              timeout: 6000\n            });\n            depsLoaders = [];\n          }\n          _context3.prev = 1;\n          _context3.next = 2;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(PLUGIN_DIR).exists();\n        case 2:\n          if (_context3.sent) {\n            _context3.next = 3;\n            break;\n          }\n          _context3.next = 3;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(DATA_STORAGE).createDirectory("plugins");\n        case 3:\n          _context3.next = 5;\n          break;\n        case 4:\n          _context3.prev = 4;\n          _t2 = _context3["catch"](1);\n          window.log("error", _t2);\n        case 5:\n          if (!/^(https?|file|content):/.test(id)) {\n            pluginUrl = utils_Url__WEBPACK_IMPORTED_MODULE_12__["default"].join(_constants__WEBPACK_IMPORTED_MODULE_13__["default"].API_BASE, "plugin/download/", "".concat(id, "?device=").concat(device.uuid));\n            if (purchaseToken) pluginUrl += "&token=".concat(purchaseToken);\n            pluginUrl += "&package=".concat(BuildInfo.packageName);\n            pluginUrl += "&version=".concat(device.version);\n            pluginDir = utils_Url__WEBPACK_IMPORTED_MODULE_12__["default"].join(PLUGIN_DIR, id);\n          } else {\n            pluginUrl = id;\n          }\n          _context3.prev = 6;\n          if (!isDependency) loaderDialog.show();\n          if (!(pluginUrl.includes(_constants__WEBPACK_IMPORTED_MODULE_13__["default"].API_BASE) || pluginUrl.startsWith("file:") || pluginUrl.startsWith("content:"))) {\n            _context3.next = 8;\n            break;\n          }\n          _context3.next = 7;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(pluginUrl).readFile(undefined, function (loaded, total) {\n            loaderDialog.setMessage("".concat(strings.loading, " ").concat((loaded / total * 100).toFixed(2), "%"));\n          });\n        case 7:\n          plugin = _context3.sent;\n          _context3.next = 10;\n          break;\n        case 8:\n          _context3.next = 9;\n          return new Promise(function (resolve, reject) {\n            cordova.plugin.http.sendRequest(pluginUrl, {\n              method: "GET",\n              responseType: "arraybuffer"\n            }, function (response) {\n              resolve(response.data);\n              loaderDialog.setMessage("".concat(strings.loading, " 100%"));\n            }, function (error) {\n              reject(error);\n            });\n          });\n        case 9:\n          plugin = _context3.sent;\n        case 10:\n          if (!plugin) {\n            _context3.next = 41;\n            break;\n          }\n          zip = new (jszip__WEBPACK_IMPORTED_MODULE_10___default())();\n          _context3.next = 11;\n          return zip.loadAsync(plugin);\n        case 11:\n          if (zip.files["plugin.json"]) {\n            _context3.next = 12;\n            break;\n          }\n          throw new Error(strings["invalid plugin"]);\n        case 12:\n          _t3 = JSON;\n          _context3.next = 13;\n          return zip.files["plugin.json"].async("text");\n        case 13:\n          _t4 = _context3.sent;\n          pluginJson = _t3.parse.call(_t3, _t4);\n          /** patch main in manifest */\n          if (!zip.files[pluginJson.main]) {\n            pluginJson.main = "main.js";\n          }\n\n          /** patch icon in manifest */\n          if (!zip.files[pluginJson.icon]) {\n            pluginJson.icon = "icon.png";\n          }\n\n          /** patch readme in manifest */\n          if (!zip.files[pluginJson.readme]) {\n            pluginJson.readme = "readme.md";\n          }\n          if (zip.files[pluginJson.main]) {\n            _context3.next = 14;\n            break;\n          }\n          throw new Error(strings["invalid plugin"]);\n        case 14:\n          if (!(!isDependency && pluginJson.dependencies)) {\n            _context3.next = 26;\n            break;\n          }\n          _context3.next = 15;\n          return resolveDepsManifest(pluginJson.dependencies);\n        case 15:\n          manifests = _context3.sent;\n          if (manifests.length > 1) {\n            titleText = "Acode wants to install the following dependencies:";\n          } else {\n            titleText = "Acode wants to install the following dependency:";\n          }\n          _context3.next = 16;\n          return (0,dialogs_confirm__WEBPACK_IMPORTED_MODULE_7__["default"])("Installer Notice", titleText + "<br /><br />" + manifests.map(function (value) {\n            return value.name;\n          }).join(", "), true);\n        case 16:\n          shouldInstall = _context3.sent;\n          if (!shouldInstall) {\n            _context3.next = 25;\n            break;\n          }\n          _iterator = _createForOfIteratorHelper(manifests);\n          _context3.prev = 17;\n          _iterator.s();\n        case 18:\n          if ((_step = _iterator.n()).done) {\n            _context3.next = 21;\n            break;\n          }\n          manifest = _step.value;\n          _context3.next = 19;\n          return resolveDep(manifest);\n        case 19:\n          hasError = _context3.sent;\n          if (!hasError) {\n            _context3.next = 20;\n            break;\n          }\n          throw new Error(strings.failed);\n        case 20:\n          _context3.next = 18;\n          break;\n        case 21:\n          _context3.next = 23;\n          break;\n        case 22:\n          _context3.prev = 22;\n          _t5 = _context3["catch"](17);\n          _iterator.e(_t5);\n        case 23:\n          _context3.prev = 23;\n          _iterator.f();\n          return _context3.finish(23);\n        case 24:\n          _context3.next = 26;\n          break;\n        case 25:\n          return _context3.abrupt("return");\n        case 26:\n          if (!pluginDir) {\n            pluginJson.source = pluginUrl;\n            id = pluginJson.id;\n            pluginDir = utils_Url__WEBPACK_IMPORTED_MODULE_12__["default"].join(PLUGIN_DIR, id);\n          }\n          _context3.next = 27;\n          return _installState__WEBPACK_IMPORTED_MODULE_14__["default"]["new"](id);\n        case 27:\n          state = _context3.sent;\n          _context3.next = 28;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(pluginDir).exists();\n        case 28:\n          if (_context3.sent) {\n            _context3.next = 29;\n            break;\n          }\n          _context3.next = 29;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(PLUGIN_DIR).createDirectory(id);\n        case 29:\n          promises = Object.keys(zip.files).map(/*#__PURE__*/function () {\n            var _ref = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee(file) {\n              var correctFile, fileUrl, data, _t;\n              return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context) {\n                while (1) switch (_context.prev = _context.next) {\n                  case 0:\n                    _context.prev = 0;\n                    correctFile = file;\n                    if (/\\\\/.test(correctFile)) {\n                      correctFile = correctFile.replace(/\\\\/g, "/");\n                    }\n                    fileUrl = utils_Url__WEBPACK_IMPORTED_MODULE_12__["default"].join(pluginDir, correctFile);\n                    if (state.exists(correctFile)) {\n                      _context.next = 1;\n                      break;\n                    }\n                    _context.next = 1;\n                    return createFileRecursive(pluginDir, correctFile);\n                  case 1:\n                    if (!correctFile.endsWith("/")) {\n                      _context.next = 2;\n                      break;\n                    }\n                    return _context.abrupt("return");\n                  case 2:\n                    _context.next = 3;\n                    return zip.files[file].async("ArrayBuffer");\n                  case 3:\n                    data = _context.sent;\n                    if (file === "plugin.json") {\n                      data = JSON.stringify(pluginJson);\n                    }\n                    _context.next = 4;\n                    return state.isUpdated(correctFile, data);\n                  case 4:\n                    if (_context.sent) {\n                      _context.next = 5;\n                      break;\n                    }\n                    return _context.abrupt("return");\n                  case 5:\n                    _context.next = 6;\n                    return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(fileUrl).writeFile(data);\n                  case 6:\n                    return _context.abrupt("return");\n                  case 7:\n                    _context.prev = 7;\n                    _t = _context["catch"](0);\n                    console.error("Error processing file ".concat(file, ":"), _t);\n                  case 8:\n                  case "end":\n                    return _context.stop();\n                }\n              }, _callee, null, [[0, 7]]);\n            }));\n            return function (_x11) {\n              return _ref.apply(this, arguments);\n            };\n          }()); // Wait for all files to be processed\n          _context3.next = 30;\n          return Promise.allSettled(promises);\n        case 30:\n          if (!isDependency) {\n            _context3.next = 31;\n            break;\n          }\n          depsLoaders.push(/*#__PURE__*/(0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee2() {\n            return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context2) {\n              while (1) switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 1;\n                  return (0,_loadPlugin__WEBPACK_IMPORTED_MODULE_15__["default"])(id, true);\n                case 1:\n                case "end":\n                  return _context2.stop();\n              }\n            }, _callee2);\n          })));\n          _context3.next = 39;\n          break;\n        case 31:\n          _iterator2 = _createForOfIteratorHelper(depsLoaders);\n          _context3.prev = 32;\n          _iterator2.s();\n        case 33:\n          if ((_step2 = _iterator2.n()).done) {\n            _context3.next = 35;\n            break;\n          }\n          _loader = _step2.value;\n          _context3.next = 34;\n          return _loader();\n        case 34:\n          _context3.next = 33;\n          break;\n        case 35:\n          _context3.next = 37;\n          break;\n        case 36:\n          _context3.prev = 36;\n          _t6 = _context3["catch"](32);\n          _iterator2.e(_t6);\n        case 37:\n          _context3.prev = 37;\n          _iterator2.f();\n          return _context3.finish(37);\n        case 38:\n          _context3.next = 39;\n          return (0,_loadPlugin__WEBPACK_IMPORTED_MODULE_15__["default"])(id, true);\n        case 39:\n          _context3.next = 40;\n          return state.save();\n        case 40:\n          deleteRedundantFiles(pluginDir, state);\n        case 41:\n          _context3.next = 50;\n          break;\n        case 42:\n          _context3.prev = 42;\n          _t7 = _context3["catch"](6);\n          _context3.prev = 43;\n          if (!state) {\n            _context3.next = 44;\n            break;\n          }\n          _context3.next = 44;\n          return state.clear();\n        case 44:\n          _t8 = pluginDir;\n          if (!_t8) {\n            _context3.next = 46;\n            break;\n          }\n          _context3.next = 45;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(pluginDir).exists();\n        case 45:\n          _t8 = _context3.sent;\n        case 46:\n          if (!_t8) {\n            _context3.next = 47;\n            break;\n          }\n          _context3.next = 47;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(pluginDir)["delete"]();\n        case 47:\n          _context3.next = 49;\n          break;\n        case 48:\n          _context3.prev = 48;\n          _t9 = _context3["catch"](43);\n          console.error("Cleanup failed:", _t9);\n        case 49:\n          throw _t7;\n        case 50:\n          _context3.prev = 50;\n          if (!isDependency) {\n            loaderDialog.destroy();\n          }\n          return _context3.finish(50);\n        case 51:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[1, 4], [6, 42, 50, 51], [17, 22, 23, 24], [32, 36, 37, 38], [43, 48]]);\n  }));\n  return _installPlugin.apply(this, arguments);\n}\nfunction createFileRecursive(_x5, _x6) {\n  return _createFileRecursive.apply(this, arguments);\n}\n/**\n * Resolves Dependencies Manifest with given ids.\n * @param {string[]} deps dependencies\n */\nfunction _createFileRecursive() {\n  _createFileRecursive = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee4(parent, dir) {\n    var isDir, cd, newParent;\n    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          isDir = false;\n          if (typeof dir === "string") {\n            if (dir.endsWith("/")) {\n              isDir = true;\n              dir = dir.slice(0, -1);\n            }\n            dir = dir.split("/");\n          }\n          dir = dir.filter(function (d) {\n            return d;\n          });\n          cd = dir.shift();\n          newParent = utils_Url__WEBPACK_IMPORTED_MODULE_12__["default"].join(parent, cd);\n          _context4.next = 1;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(newParent).exists();\n        case 1:\n          if (_context4.sent) {\n            _context4.next = 4;\n            break;\n          }\n          if (!(dir.length || isDir)) {\n            _context4.next = 3;\n            break;\n          }\n          _context4.next = 2;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(parent).createDirectory(cd);\n        case 2:\n          _context4.next = 4;\n          break;\n        case 3:\n          _context4.next = 4;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(parent).createFile(cd);\n        case 4:\n          if (!dir.length) {\n            _context4.next = 5;\n            break;\n          }\n          _context4.next = 5;\n          return createFileRecursive(newParent, dir);\n        case 5:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return _createFileRecursive.apply(this, arguments);\n}\nfunction resolveDepsManifest(_x7) {\n  return _resolveDepsManifest.apply(this, arguments);\n}\n/** Resolve dependency\n * @param {object} manifest\n * @returns {Promise<boolean>} has error\n */\nfunction _resolveDepsManifest() {\n  _resolveDepsManifest = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee6(deps) {\n    var resolved, _iterator3, _step3, dependency, remoteDependency, version, manifests, getInstalledPluginVersion, _getInstalledPluginVersion, _t0;\n    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          _getInstalledPluginVersion = function _getInstalledPluginVe2() {\n            _getInstalledPluginVersion = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee5(id) {\n              var plugin;\n              return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context5) {\n                while (1) switch (_context5.prev = _context5.next) {\n                  case 0:\n                    _context5.next = 1;\n                    return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(PLUGIN_DIR, id).exists();\n                  case 1:\n                    if (!_context5.sent) {\n                      _context5.next = 3;\n                      break;\n                    }\n                    _context5.next = 2;\n                    return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(PLUGIN_DIR, id, "plugin.json").readFile("json");\n                  case 2:\n                    plugin = _context5.sent;\n                    return _context5.abrupt("return", plugin.version);\n                  case 3:\n                  case "end":\n                    return _context5.stop();\n                }\n              }, _callee5);\n            }));\n            return _getInstalledPluginVersion.apply(this, arguments);\n          };\n          getInstalledPluginVersion = function _getInstalledPluginVe(_x12) {\n            return _getInstalledPluginVersion.apply(this, arguments);\n          };\n          resolved = [];\n          _iterator3 = _createForOfIteratorHelper(deps);\n          _context6.prev = 1;\n          _iterator3.s();\n        case 2:\n          if ((_step3 = _iterator3.n()).done) {\n            _context6.next = 10;\n            break;\n          }\n          dependency = _step3.value;\n          _context6.next = 3;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(_constants__WEBPACK_IMPORTED_MODULE_13__["default"].API_BASE, "plugin/".concat(dependency)).readFile("json")["catch"](function () {\n            return null;\n          });\n        case 3:\n          remoteDependency = _context6.sent;\n          if (remoteDependency) {\n            _context6.next = 4;\n            break;\n          }\n          throw new Error("Unknown plugin dependency: ".concat(dependency));\n        case 4:\n          _context6.next = 5;\n          return getInstalledPluginVersion(remoteDependency.id);\n        case 5:\n          version = _context6.sent;\n          if (!((remoteDependency === null || remoteDependency === void 0 ? void 0 : remoteDependency.version) === version)) {\n            _context6.next = 6;\n            break;\n          }\n          return _context6.abrupt("continue", 9);\n        case 6:\n          if (!remoteDependency.dependencies) {\n            _context6.next = 8;\n            break;\n          }\n          _context6.next = 7;\n          return resolveDepsManifest(remoteDependency.dependencies);\n        case 7:\n          manifests = _context6.sent;\n          resolved.push(manifests);\n        case 8:\n          resolved.push(remoteDependency);\n        case 9:\n          _context6.next = 2;\n          break;\n        case 10:\n          _context6.next = 12;\n          break;\n        case 11:\n          _context6.prev = 11;\n          _t0 = _context6["catch"](1);\n          _iterator3.e(_t0);\n        case 12:\n          _context6.prev = 12;\n          _iterator3.f();\n          return _context6.finish(12);\n        case 13:\n          return _context6.abrupt("return", resolved);\n        case 14:\n        case "end":\n          return _context6.stop();\n      }\n    }, _callee6, null, [[1, 11, 12, 13]]);\n  }));\n  return _resolveDepsManifest.apply(this, arguments);\n}\nfunction resolveDep(_x8) {\n  return _resolveDep.apply(this, arguments);\n}\n/**\n *\n * @param {string} dir\n * @param {Array<string>} files\n */\nfunction _resolveDep() {\n  _resolveDep = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee0(manifest) {\n    var purchaseToken, product, isPaid, _yield$helpers$promis, _yield$helpers$promis2, purchase, _iap, onpurchase, onerror, apiStatus, getPurchase, _getPurchase;\n    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context0) {\n      while (1) switch (_context0.prev = _context0.next) {\n        case 0:\n          _getPurchase = function _getPurchase3() {\n            _getPurchase = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee9(sku) {\n              var purchases, purchase;\n              return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context9) {\n                while (1) switch (_context9.prev = _context9.next) {\n                  case 0:\n                    _context9.next = 1;\n                    return utils_helpers__WEBPACK_IMPORTED_MODULE_11__["default"].promisify(iap.getPurchases);\n                  case 1:\n                    purchases = _context9.sent;\n                    purchase = purchases.find(function (p) {\n                      return p.productIds.includes(sku);\n                    });\n                    return _context9.abrupt("return", purchase);\n                  case 2:\n                  case "end":\n                    return _context9.stop();\n                }\n              }, _callee9);\n            }));\n            return _getPurchase.apply(this, arguments);\n          };\n          getPurchase = function _getPurchase2(_x15) {\n            return _getPurchase.apply(this, arguments);\n          };\n          isPaid = false;\n          isPaid = manifest.price > 0;\n          _context0.next = 1;\n          return utils_helpers__WEBPACK_IMPORTED_MODULE_11__["default"].promisify(iap.getProducts, [manifest.sku]);\n        case 1:\n          _yield$helpers$promis = _context0.sent;\n          _yield$helpers$promis2 = (0,_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__["default"])(_yield$helpers$promis, 1);\n          product = _yield$helpers$promis2[0];\n          if (!product) {\n            _context0.next = 3;\n            break;\n          }\n          _context0.next = 2;\n          return getPurchase(product.productId);\n        case 2:\n          purchase = _context0.sent;\n          purchaseToken = purchase === null || purchase === void 0 ? void 0 : purchase.purchaseToken;\n        case 3:\n          if (!(isPaid && !purchaseToken)) {\n            _context0.next = 7;\n            break;\n          }\n          onpurchase = /*#__PURE__*/function () {\n            var _ref3 = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee7(e) {\n              var purchase;\n              return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context7) {\n                while (1) switch (_context7.prev = _context7.next) {\n                  case 0:\n                    _context7.next = 1;\n                    return getPurchase(product.productId);\n                  case 1:\n                    purchase = _context7.sent;\n                    _context7.next = 2;\n                    return _deadlyjack_ajax__WEBPACK_IMPORTED_MODULE_5___default().post(utils_Url__WEBPACK_IMPORTED_MODULE_12__["default"].join(_constants__WEBPACK_IMPORTED_MODULE_13__["default"].API_BASE, "plugin/order"), {\n                      data: {\n                        id: manifest.id,\n                        token: purchase === null || purchase === void 0 ? void 0 : purchase.purchaseToken,\n                        "package": BuildInfo.packageName\n                      }\n                    });\n                  case 2:\n                    purchaseToken = purchase === null || purchase === void 0 ? void 0 : purchase.purchaseToken;\n                  case 3:\n                  case "end":\n                    return _context7.stop();\n                }\n              }, _callee7);\n            }));\n            return function onpurchase(_x13) {\n              return _ref3.apply(this, arguments);\n            };\n          }();\n          onerror = /*#__PURE__*/function () {\n            var _ref4 = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee8(error) {\n              return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context8) {\n                while (1) switch (_context8.prev = _context8.next) {\n                  case 0:\n                    throw error;\n                  case 1:\n                  case "end":\n                    return _context8.stop();\n                }\n              }, _callee8);\n            }));\n            return function onerror(_x14) {\n              return _ref4.apply(this, arguments);\n            };\n          }();\n          if (product) {\n            _context0.next = 4;\n            break;\n          }\n          throw new Error("Product not found");\n        case 4:\n          _context0.next = 5;\n          return utils_helpers__WEBPACK_IMPORTED_MODULE_11__["default"].checkAPIStatus();\n        case 5:\n          apiStatus = _context0.sent;\n          if (apiStatus) {\n            _context0.next = 6;\n            break;\n          }\n          (0,dialogs_alert__WEBPACK_IMPORTED_MODULE_6__["default"])(strings.error, strings.api_error);\n          return _context0.abrupt("return", true);\n        case 6:\n          (_iap = iap).setPurchaseUpdatedListener.apply(_iap, (0,_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__["default"])((0,handlers_purchase__WEBPACK_IMPORTED_MODULE_9__["default"])(onpurchase, onerror)));\n          loaderDialog.setMessage(strings["loading..."]);\n          _context0.next = 7;\n          return utils_helpers__WEBPACK_IMPORTED_MODULE_11__["default"].promisify(iap.purchase, product.productId);\n        case 7:\n          loaderDialog.setMessage("".concat(strings.installing.replace("...", ""), " ").concat(manifest.name, "..."));\n          _context0.next = 8;\n          return installPlugin(manifest.id, undefined, purchaseToken, true);\n        case 8:\n        case "end":\n          return _context0.stop();\n      }\n    }, _callee0);\n  }));\n  return _resolveDep.apply(this, arguments);\n}\nfunction listFileRecursive(_x9, _x0) {\n  return _listFileRecursive.apply(this, arguments);\n}\n/**\n *\n * @param {Record<string, boolean>} files\n */\nfunction _listFileRecursive() {\n  _listFileRecursive = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee1(dir, files) {\n    var _iterator4, _step4, child, fileUrl, _t1, _t10, _t11;\n    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context1) {\n      while (1) switch (_context1.prev = _context1.next) {\n        case 0:\n          _t1 = _createForOfIteratorHelper;\n          _context1.next = 1;\n          return (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(dir).lsDir();\n        case 1:\n          _t10 = _context1.sent;\n          _iterator4 = _t1(_t10);\n          _context1.prev = 2;\n          _iterator4.s();\n        case 3:\n          if ((_step4 = _iterator4.n()).done) {\n            _context1.next = 7;\n            break;\n          }\n          child = _step4.value;\n          fileUrl = utils_Url__WEBPACK_IMPORTED_MODULE_12__["default"].join(dir, child.name);\n          if (!child.isDirectory) {\n            _context1.next = 5;\n            break;\n          }\n          _context1.next = 4;\n          return listFileRecursive(fileUrl, files);\n        case 4:\n          _context1.next = 6;\n          break;\n        case 5:\n          files.push(fileUrl);\n        case 6:\n          _context1.next = 3;\n          break;\n        case 7:\n          _context1.next = 9;\n          break;\n        case 8:\n          _context1.prev = 8;\n          _t11 = _context1["catch"](2);\n          _iterator4.e(_t11);\n        case 9:\n          _context1.prev = 9;\n          _iterator4.f();\n          return _context1.finish(9);\n        case 10:\n        case "end":\n          return _context1.stop();\n      }\n    }, _callee1, null, [[2, 8, 9, 10]]);\n  }));\n  return _listFileRecursive.apply(this, arguments);\n}\nfunction deleteRedundantFiles(_x1, _x10) {\n  return _deleteRedundantFiles.apply(this, arguments);\n}\nfunction _deleteRedundantFiles() {\n  _deleteRedundantFiles = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark(function _callee10(pluginDir, state) {\n    var files, _i, _files, file;\n    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap(function (_context10) {\n      while (1) switch (_context10.prev = _context10.next) {\n        case 0:\n          /** @type {string[]} */\n          files = [];\n          _context10.next = 1;\n          return listFileRecursive(pluginDir, files);\n        case 1:\n          for (_i = 0, _files = files; _i < _files.length; _i++) {\n            file = _files[_i];\n            if (!state.exists(file.replace("".concat(pluginDir, "/"), ""))) {\n              (0,fileSystem__WEBPACK_IMPORTED_MODULE_4__["default"])(file)["delete"]();\n            }\n          }\n        case 2:\n        case "end":\n          return _context10.stop();\n      }\n    }, _callee10);\n  }));\n  return _deleteRedundantFiles.apply(this, arguments);\n}\n\n//# sourceURL=webpack://com.foxdebug.acode/./src/lib/installPlugin.js?\n}',
				);

				/***/
			},
	},
]);
