"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkcom_foxdebug_acode"] =
	self["webpackChunkcom_foxdebug_acode"] || []).push([
	["src_lib_installState_js"],
	{
		/***/ "./src/lib/installState.js":
			/*!*********************************!*\
  !*** ./src/lib/installState.js ***!
  \*********************************/
			/***/ function (
				__unused_webpack_module,
				__webpack_exports__,
				__webpack_require__,
			) {
				eval(
					'{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": function() { return /* binding */ InstallState; }\n/* harmony export */ });\n/* harmony import */ var _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/slicedToArray */ "./node_modules/@babel/runtime/helpers/esm/slicedToArray.js");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ "./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");\n/* harmony import */ var _babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/classCallCheck */ "./node_modules/@babel/runtime/helpers/esm/classCallCheck.js");\n/* harmony import */ var _babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @babel/runtime/helpers/createClass */ "./node_modules/@babel/runtime/helpers/esm/createClass.js");\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @babel/runtime/helpers/defineProperty */ "./node_modules/@babel/runtime/helpers/esm/defineProperty.js");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @babel/runtime/regenerator */ "./node_modules/@babel/runtime/regenerator/index.js");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var fileSystem__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! fileSystem */ "./src/fileSystem/index.js");\n/* harmony import */ var utils_Url__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! utils/Url */ "./src/utils/Url.js");\n\n\n\n\n\n\n\n\nvar INSTALL_STATE_STORAGE = utils_Url__WEBPACK_IMPORTED_MODULE_7__["default"].join(DATA_STORAGE, ".install-state");\nvar InstallState = /*#__PURE__*/function () {\n  function InstallState() {\n    (0,_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, InstallState);\n    /** @type Record<string, string> */\n    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_4__["default"])(this, "store", void 0);\n    /** @type Record<string, string> */\n    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_4__["default"])(this, "updatedStore", void 0);\n  }\n  return (0,_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(InstallState, [{\n    key: "isUpdated",\n    value: (\n    /**\n     *\n     * @param {string} url\n     * @param {ArrayBuffer | string} content\n     * @param {boolean} isString\n     * @returns\n     */\n    function () {\n      var _isUpdated = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().mark(function _callee(url, content) {\n        var current, update, _t;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              url = url.toLowerCase();\n              current = this.store[url];\n              if (!(typeof content === "string")) {\n                _context.next = 2;\n                break;\n              }\n              _context.next = 1;\n              return checksumText(content);\n            case 1:\n              _t = _context.sent;\n              _context.next = 4;\n              break;\n            case 2:\n              _context.next = 3;\n              return checksum(content);\n            case 3:\n              _t = _context.sent;\n            case 4:\n              update = _t;\n              this.updatedStore[url] = update;\n              if (!(current === update)) {\n                _context.next = 5;\n                break;\n              }\n              return _context.abrupt("return", false);\n            case 5:\n              return _context.abrupt("return", true);\n            case 6:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function isUpdated(_x, _x2) {\n        return _isUpdated.apply(this, arguments);\n      }\n      return isUpdated;\n    }()\n    /**\n     *\n     * @param {string} url\n     * @returns\n     */\n    )\n  }, {\n    key: "exists",\n    value: function exists(url) {\n      if (typeof this.store[url.toLowerCase()] !== "undefined") {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }, {\n    key: "save",\n    value: function () {\n      var _save = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().mark(function _callee2() {\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().wrap(function (_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              this.store = this.updatedStore;\n              _context2.next = 1;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(this.storeUrl).writeFile(JSON.stringify(this.updatedStore));\n            case 1:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function save() {\n        return _save.apply(this, arguments);\n      }\n      return save;\n    }()\n  }, {\n    key: "delete",\n    value: function () {\n      var _delete2 = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().mark(function _callee3(url) {\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().wrap(function (_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              url = url.toLowerCase();\n              _context3.next = 1;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(url).exists();\n            case 1:\n              if (!_context3.sent) {\n                _context3.next = 2;\n                break;\n              }\n              _context3.next = 2;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(url)["delete"]();\n            case 2:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }));\n      function _delete(_x3) {\n        return _delete2.apply(this, arguments);\n      }\n      return _delete;\n    }()\n  }, {\n    key: "clear",\n    value: function () {\n      var _clear = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().mark(function _callee4() {\n        var _t2;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().wrap(function (_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              this.store = {};\n              this.updatedStore = {};\n              _context4.next = 1;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(this.storeUrl).writeFile("{}");\n            case 1:\n              _context4.next = 3;\n              break;\n            case 2:\n              _context4.prev = 2;\n              _t2 = _context4["catch"](0);\n              console.error("Failed to clear install state:", _t2);\n            case 3:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 2]]);\n      }));\n      function clear() {\n        return _clear.apply(this, arguments);\n      }\n      return clear;\n    }()\n  }], [{\n    key: "new",\n    value: (\n    /**\n     *\n     * @param {string} id\n     * @returns\n     */\n    function () {\n      var _new2 = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().mark(function _callee5(id) {\n        var state, patchedStore, _i, _Object$entries, _Object$entries$_i, key, value, _t3, _t4, _t5;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().wrap(function (_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              state = new InstallState();\n              _context5.next = 1;\n              return checksumText(id);\n            case 1:\n              state.id = _context5.sent;\n              state.updatedStore = {};\n              _context5.next = 2;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(INSTALL_STATE_STORAGE).exists();\n            case 2:\n              if (_context5.sent) {\n                _context5.next = 3;\n                break;\n              }\n              _context5.next = 3;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(DATA_STORAGE).createDirectory(".install-state");\n            case 3:\n              state.storeUrl = utils_Url__WEBPACK_IMPORTED_MODULE_7__["default"].join(INSTALL_STATE_STORAGE, state.id);\n              _context5.next = 4;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(state.storeUrl).exists();\n            case 4:\n              if (!_context5.sent) {\n                _context5.next = 6;\n                break;\n              }\n              _t3 = JSON;\n              _context5.next = 5;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(state.storeUrl).readFile("utf-8");\n            case 5:\n              _t4 = _context5.sent;\n              state.store = _t3.parse.call(_t3, _t4);\n              patchedStore = {};\n              for (_i = 0, _Object$entries = Object.entries(state.store); _i < _Object$entries.length; _i++) {\n                _Object$entries$_i = (0,_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__["default"])(_Object$entries[_i], 2), key = _Object$entries$_i[0], value = _Object$entries$_i[1];\n                patchedStore[key.toLowerCase()] = value;\n              }\n              state.store = patchedStore;\n              _context5.next = 7;\n              break;\n            case 6:\n              state.store = {};\n              _context5.next = 7;\n              return (0,fileSystem__WEBPACK_IMPORTED_MODULE_6__["default"])(INSTALL_STATE_STORAGE).createFile(state.id);\n            case 7:\n              return _context5.abrupt("return", state);\n            case 8:\n              _context5.prev = 8;\n              _t5 = _context5["catch"](0);\n              console.error(_t5);\n            case 9:\n            case "end":\n              return _context5.stop();\n          }\n        }, _callee5, null, [[0, 8]]);\n      }));\n      function _new(_x4) {\n        return _new2.apply(this, arguments);\n      }\n      return _new;\n    }())\n  }]);\n}();\n/**\n * Derives the checksum of a Buffer\n * @param {BufferSource} data\n * @returns the derived checksum\n */\n\nfunction checksum(_x5) {\n  return _checksum.apply(this, arguments);\n}\n/**\n *\n * @param {string} text\n * @returns\n */\nfunction _checksum() {\n  _checksum = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().mark(function _callee6(data) {\n    var hashBuffer, hashArray, hashHex;\n    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().wrap(function (_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 1;\n          return window.crypto.subtle.digest("SHA-256", data);\n        case 1:\n          hashBuffer = _context6.sent;\n          hashArray = Array.from(new Uint8Array(hashBuffer));\n          hashHex = hashArray.map(function (_byte) {\n            return _byte.toString(16).padStart(2, "0");\n          }).join("");\n          return _context6.abrupt("return", hashHex);\n        case 2:\n        case "end":\n          return _context6.stop();\n      }\n    }, _callee6);\n  }));\n  return _checksum.apply(this, arguments);\n}\nfunction checksumText(_x6) {\n  return _checksumText.apply(this, arguments);\n}\nfunction _checksumText() {\n  _checksumText = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__["default"])(/*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().mark(function _callee7(text) {\n    var textUint8;\n    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_5___default().wrap(function (_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          textUint8 = new TextEncoder().encode(text);\n          _context7.next = 1;\n          return checksum(textUint8);\n        case 1:\n          return _context7.abrupt("return", _context7.sent);\n        case 2:\n        case "end":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return _checksumText.apply(this, arguments);\n}\n\n//# sourceURL=webpack://com.foxdebug.acode/./src/lib/installState.js?\n}',
				);

				/***/
			},
	},
]);
