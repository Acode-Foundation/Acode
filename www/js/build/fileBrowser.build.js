(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{530:function(e,t,n){},547:function(e,t,n){"use strict";n.r(t);var i=n(70),r=n.n(i),o=n(1),a=n.n(o),s=n(56),c=n.n(s),l=n(71),u=n(17),d=n(3),f=n(200),p=n(5),h=n(15),g=n(91);function m(e){var t=Object(l.a)(strings.settings),n=a()("div",{className:"main list"});actionStack.push({id:"settings-theme",action:t.hide}),t.onhide=function(){actionStack.remove("settings-theme")};var i=appSettings.value.fileBrowser,r=[{key:"sort",text:strings["sort by name"],checkbox:i.sortByName},{key:"show",text:strings["show hidden files"],checkbox:i.showHiddenFiles}];g.a.listItems(n,r,(function(){switch(this.key){case"sort":i.sortByName=!i.sortByName,appSettings.update(),this.value=i.sortByName,e&&e();break;case"show":i.showHiddenFiles=!i.showHiddenFiles,appSettings.update(),this.value=i.showHiddenFiles,e&&e()}})),t.appendChild(n),document.body.append(t)}n(530);var v=n(142),b=n(57),w=n(201),y={angular:function(){return n.e(1).then(n.bind(null,541))},angularjs:function(){return n.e(2).then(n.bind(null,542))},html:function(){return n.e(10).then(n.bind(null,543))},react:function(){return n.e(12).then(n.bind(null,544))},vue:function(){return n.e(16).then(n.bind(null,545))}};t.default=function(e,t,n){e||(e="file"),!n&&localStorage.lastDir&&(n=localStorage.lastDir);var i=window.actionStack,o=p.a.prompt;return new Promise((function(n,s){var g,x,S=a()("i",{className:"icon more_vert",attr:{action:"toggle-menu"}}),k=a()("i",{className:"icon add disabled",attr:{action:"toggle-add-menu"}}),L=a()("i",{className:"icon search",attr:{action:"search"}}),j=Object(l.a)("File Browser"),E=a.a.parse(c.a.render('<div tabindex="-1" class="main" id="file-browser" type="{{type}}">\n  <div class="navigation" tabindex="-1"></div>\n</div>',{type:e})),D=E.querySelector(".navigation"),F=[],O={top:"8px",right:"8px",toggle:S,transformOrigin:"top right"},N=Object(f.a)('<li action="settings">'.concat(strings.settings,"</li>"),O),B=Object(f.a)(c.a.render('<li action="create" value="file">{{new file}}</li>\n<li action="create" value="folder">{{new folder}}</li>\n<li action="create" value="project">{{new project}}</li>',strings),(O.toggle=k)&&O),A="file:///storage/",I={},R={url:"/",name:"File browser"};if(E.addEventListener("click",P),E.addEventListener("contextmenu",J),j.append(E),j.querySelector("header").append(L,k,S),document.body.append(j),i.push({id:"filebrowser",action:function(){s({error:"user canceled",code:0}),j.hide()}}),N.onclick=function(e){N.hide();var t=e.target.getAttribute("action");t&&"settings"===t&&m(T)},B.onclick=function(e){B.hide();var t=e.target.getAttribute("action"),n=e.target.getAttribute("value");t&&"create"===t&&function(e){var t=R.url,n=R.name;if("file"===e||"folder"===e){var i=strings["enter folder name"],r=strings["new folder"];"file"===e&&(i=strings["enter file name"],r="untitiled.txt"),o(i,r,"filename",{match:h.a.FILE_NAME_REGEX,required:!0}).then((function(i){i&&(i=d.a.removeLineBreaks(i),Object(b.a)(t).then((function(t){return"folder"===e?t.createDirectory(i):"file"===e?t.createFile(i):void 0})).then((function(){M(t),window.plugins.toast.showLongBottom(strings.success),C(t,n)})).catch((function(e){d.a.error(e,t,"filename: "+i),console.error(e)})))}))}else if("project"===e){var a=[],s=[],c="",l="",u=null,f="",g="";Object.keys(y).map((function(e){a.push([e,e,"icon "+e])})),p.a.select(strings["new project"],a).then((function(e){return g=e,p.a.loaderShow(e,strings.loading+"..."),y[e]()})).then((function(e){return p.a.loaderHide(),c=e.default,p.a.prompt(strings["project name"],g,"text",{required:!0,match:h.a.FILE_NAME_REGEX})})).then((function(e){return f=e,Object(b.a)(t)})).then((function(e){return p.a.loaderShow(f,strings.loading+"..."),e.createDirectory(f)})).then((function(e){u=t+f+"/";var i=Object.keys(c);return new Promise((function(e,r){!function e(r,o){i.length||(M(t),window.plugins.toast.showLongBottom(strings.success),C(t,n),r());var a=i.pop();l=[],(d=a,p=d.split("/"),h=p.pop(),new Promise((function(e,t){!function n(){var i=u+l;if(0===p.length)return Object(b.a)(i).then((function(e){var t=c[d].replace(/<%name%>/g,f);return e.createFile(h,t)})).then(e).catch(t);var r=p.splice(0,1)[0],o=i+r;Object(b.a)(i).then((function(e){return s.includes(o)?Promise.resolve():e.createDirectory(r)})).then((function(e){return s.includes(o)||s.push(o),l+=r+"/",n(p)})).catch(t)}()}))).then((function(){e(r,o)})).catch(o);var d,p,h}(e,r)}))})).catch((function(e){d.a.error(e),console.error(e)})).finally((function(){p.a.loaderHide()}))}}(n)},L.onclick=function(){var e=E.get("#list");e&&Object(w.a)(e)},j.onhide=function(){for(var e="";e=F.pop();)i.remove(e);i.remove("filebrowser"),E.removeEventListener("click",P),E.removeEventListener("contextmenu",J)},"folder"===e){var q=a()("button",{textContent:t||strings["select folder"]});g=a()("footer",{className:"button-container",child:q}),j.setAttribute("footer-height",1),j.append(g),q.onclick=function(){j.hide(),_(R)}}function _(e){localStorage.setItem("lastDir",R.url),n(e)}function H(){cordova.plugins.diagnostic.getExternalSdCardDetails((function(t){var n=[];t.length>0&&t.map((function(e){var t=e.path.split("/").splice(-1)[0],i=e.filePath+"/";return"files"===t||n.push({name:x&&x[t]?x[t]:t,nativeURL:i,origin:i,isDirectory:!0,parent:!0,type:"folder"}),e}));var i=cordova.file.externalRootDirectory;n.push({nativeURL:i,name:"Internal storage",isDirectory:!0,parent:!0,type:"folder"}),"file"===e&&n.push({name:"Select document",isDirectory:!0,type:"folder","open-doc":!0}),I["/"]={name:name,list:n},G("/","/"),U(n),"folder"===e&&g.classList.add("disabled")}))}function C(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"File Browser";if("/"===t)return H();var o=t;if("object"===r()(t)&&(o=t.url,n=t.name),o in I){l();var s=I[o];U(s.list);var c=a.a.get("#list");c.scrollTop=s.scroll,n=s.name}else u.a.listDir(o).then((function(e){l(),e=d.a.sortDir(e,appSettings.value.fileBrowser),I[o]={name:n,list:e},U(e)})).catch((function(e){i.remove(R.url),d.a.error(e,o),console.error(e)}));function l(){"folder"===e&&(o===A?(k.classList.add("disabled"),g.classList.add("disabled")):(k.classList.remove("disabled"),g.classList.remove("disabled"))),R.url=o,R.name=n;var t=a.a.get("#list");t&&(t.scrollTop=0),G(n,o),j.settitle(n)}}function P(e,n){var r=e.target,o=r.getAttribute("action");if(o){var s=r.getAttribute("url"),c=r.getAttribute("name");switch(r.getAttribute("open-doc")&&(o="open-doc"),o){case"navigation":case"folder":!function(){if("contextmenu"!==n){var e=R.url,t=JSON.parse(JSON.stringify(R));I[e].scroll=a.a.get("#list").scrollTop,F.push(e),i.push({id:e,action:function(){F.pop(),C(t),"folder"===o&&G.pop()}}),C(s,c)}else l()}();break;case"file":"contextmenu"!==n?"function"==typeof t&&t(c)&&(j.hide(),_({url:s})):l();break;case"open-doc":SDcard.openDoc((function(e){e.isContentUri=!0,e.url=e.uri,_(e),j.hide()}),(function(e){d.a.error(e),console.error(e)}))}}function l(){navigator.vibrate(50),p.a.select("",[["delete",strings.delete,"delete"],["rename",strings.rename,"edit"]]).then((function(e){switch(e){case"delete":p.a.confirm(strings["delete {name}"].replace("{name}",c)).then(u);break;case"rename":p.a.prompt(strings.rename,c,"text",{match:h.a.FILE_NAME_REGEX}).then((function(e){!function(e){Object(b.a)(s).then((function(t){return t.renameTo(e)})).then((function(){M(s),window.plugins.toast.showShortBottom(strings.success),C(R)})).catch((function(e){d.a.error(e),console.error(e)}))}(e)}))}}))}function u(){Object(b.a)(s).then((function(e){return e.deleteFile()})).then((function(){M(s),window.plugins.toast.showShortBottom(strings.success),C(R)})).catch((function(e){console.log(e),d.a.error(e)}))}}function J(e){P(e,"contextmenu")}function T(){I={},C(R.url,R.name)}function U(e){var t=a.a.parse(c.a.render('<ul class="list" id="list" empty-msg="{{msg}}">{{#list}}\n  {{#.}}\n  <li tabindex="1" class="tile" url="{{nativeURL}}" origin="{{origin}}" {{#isDirectory}} action="folder" type="folder"\n    {{/isDirectory}} {{#canWrite}} can-write="true" {{/canWrite}} uuid="{{uuid}}" {{#isFile}} action="file" type="file"\n    {{/isFile}} name="{{name}}" {{#open-doc}} open-doc="true" {{/open-doc}}>\n    <span class="icon {{type}}"></span>\n    <div class="text">\n      <span>{{name}}</span>\n    </div>\n  </li>\n  {{/.}}\n  {{/list}}</ul>',{msg:strings["empty folder message"],list:e})),n=E.querySelector("#list");n&&n.remove(),E.append(t),t.focus()}function G(e,t){var n=D.querySelector('[url="'.concat(t,'"]')),i=D.querySelector(".active");if(i&&i.classList.remove("active"),n)return n.classList.add("active");n=a()("span",{className:"nav active",attr:{action:"navigation",url:t,text:e,name:e},tabIndex:-1}),D.append(n),D.scrollLeft=D.scrollWidth}function M(e){I[e]&&delete I[e],I[R.url]&&delete I[R.url];var t=!0,n=!1,i=void 0;try{for(var r,o=addedFolder[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a.url===e?a.remove():new RegExp(e).test(R.url)&&a.reload()}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}parseInt(device.version)<7?H():v.a.listExternalStorages().then((function(e){x=e,H()})),G.pop=function(){var e=D.lastChild;e&&e.remove()}}))}}}]);